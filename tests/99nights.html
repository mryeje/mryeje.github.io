<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>99 Nights ‚Äî Playbook</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --accent:#6ee7b7; --muted:#9aa8bb; --glass: rgba(255,255,255,0.03);
    --ui-size: 18px;
  }
  html,body{height:100%;margin:0;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:linear-gradient(180deg,#061226 0%, #07162a 100%); color:#e6f3f2;}
  .app{max-width:820px;margin:0 auto;padding:14px;box-sizing:border-box;display:flex;flex-direction:column;gap:12px;}
  header{display:flex;align-items:center;gap:12px;}
  h1{font-size:20px;margin:0;color:var(--accent)}
  .selector{background:var(--card);border-radius:14px;padding:12px;display:flex;gap:8px;align-items:center;width:100%;}
  .big-btn{background:var(--accent);color:#042023;border:none;padding:12px 16px;border-radius:12px;font-weight:700;font-size:16px;touch-action: manipulation;}
  .big-icon-btn{background:transparent;border:2px solid var(--muted);color:var(--muted);padding:12px;border-radius:12px;font-size:18px;min-width:56px;}
  .day-display{font-size:18px;font-weight:700;color:#fff;padding:6px 12px;border-radius:10px;background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));}
  .row{display:flex;gap:12px;align-items:center;}
  .main-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:12px;box-shadow: 0 6px 18px rgba(2,6,23,0.6);}
  .title{font-size:18px;font-weight:800;margin:6px 0;color:var(--accent);}
  .images-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
  .img-slot{background:var(--glass);height:120px;border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden;border:2px dashed rgba(255,255,255,0.03);}
  .img-slot img{width:100%;height:100%;object-fit:cover;display:block;}
  .img-label{position:absolute;left:8px;top:8px; background:rgba(0,0,0,0.35);padding:6px;border-radius:6px;font-size:12px;color:var(--muted);}
  .placeholder-text{font-size:13px;color:var(--muted);text-align:center;padding:10px;}
  .controls{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:8px;}
  textarea{width:100%;min-height:64px;border-radius:10px;padding:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;resize:vertical;font-size:15px;}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px;}
  .small-row{display:flex;gap:8px;}
  .chip{background:rgba(255,255,255,0.02);padding:6px 8px;border-radius:10px;font-size:13px;color:var(--muted);}
  .action-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
  .muted{color:var(--muted);font-size:13px;}
  input[type=file]{display:none;}
  .footer{font-size:13px;color:var(--muted);text-align:center;padding:8px 0;}
  /* portrait adjustments for iPad-size touch targets */
  @media (max-width:820px){
    .img-slot{height:120px}
    .big-btn{flex:1}
  }
  /* make things slightly bigger for touch */
  button, textarea { -webkit-tap-highlight-color: rgba(0,0,0,0); }
</style>
</head>
<body>
<div class="app" role="application" aria-label="99 Nights Playbook">
  <header>
    <div style="flex:1">
      <h1>üå≤ 99 Nights ‚Äî Playbook</h1>
      <div class="muted">Portrait-friendly iPad UI ‚Äî big buttons for kids</div>
    </div>
    <div style="width:120px;text-align:right">
      <div class="chip" id="selectedDayDisplay">Day 1</div>
    </div>
  </header>

  <section class="main-card">
    <div class="selector" aria-hidden="false">
      <button class="big-icon-btn" id="prevBtn" title="Previous day">‚óÄ</button>
      <div style="flex:1;display:flex;flex-direction:column;gap:6px;">
        <div style="display:flex;gap:8px;align-items:center;">
          <div style="flex:1">
            <select id="daySelect" style="width:100%;padding:12px;border-radius:10px;border:none;font-size:16px;">
              <!-- options populated by JS -->
            </select>
          </div>
          <button class="big-btn" id="startBtn">Start Mission ‚ñ∂</button>
        </div>
        <div style="display:flex;gap:8px;">
          <button id="randomBtn" class="big-icon-btn">üé≤</button>
          <button id="resetImages" class="big-icon-btn" title="Clear saved photos">üóëÔ∏è</button>
          <div style="flex:1" class="muted">Tap image boxes to add photos (saved locally).</div>
        </div>
      </div>
      <button class="big-icon-btn" id="nextBtn" title="Next day">‚ñ∂</button>
    </div>

    <div style="margin-top:12px;">
      <div class="title" id="scenarioTitle">Scenario title</div>

      <div class="images-grid" id="imagesGrid" aria-hidden="false">
        <!-- 6 image slots -->
        <div class="img-slot" data-key="front_deck" id="slot-front">
          <div class="img-label">Front Deck</div>
          <div class="placeholder-text">Tap to add photo</div>
          <input type="file" accept="image/*" id="file-front">
        </div>
        <div class="img-slot" data-key="treehouse" id="slot-tree">
          <div class="img-label">Treehouse</div>
          <div class="placeholder-text">Tap to add photo</div>
          <input type="file" accept="image/*" id="file-tree">
        </div>
        <div class="img-slot" data-key="culdesac" id="slot-cul">
          <div class="img-label">Cul-de-sac</div>
          <div class="placeholder-text">Tap to add photo</div>
          <input type="file" accept="image/*" id="file-cul">
        </div>
        <div class="img-slot" data-key="trampoline" id="slot-tramp">
          <div class="img-label">Trampoline</div>
          <div class="placeholder-text">Tap to add photo</div>
          <input type="file" accept="image/*" id="file-tramp">
        </div>
        <div class="img-slot" data-key="gazebo" id="slot-gaz">
          <div class="img-label">Gazebo</div>
          <div class="placeholder-text">Tap to add photo</div>
          <input type="file" accept="image/*" id="file-gaz">
        </div>
        <div class="img-slot" data-key="pool" id="slot-pool">
          <div class="img-label">Pool</div>
          <div class="placeholder-text">Tap to add photo</div>
          <input type="file" accept="image/*" id="file-pool">
        </div>
      </div>
    </div>

    <div style="margin-top:12px;">
      <label for="itemsText">üß∞ Items</label>
      <textarea id="itemsText" placeholder="List of things used in this scenario..." readonly></textarea>

      <label for="locationText" style="margin-top:8px;">üìç Locations</label>
      <textarea id="locationText" placeholder="Where this scenario happens..." readonly></textarea>

      <label for="missionText" style="margin-top:8px;">üéØ Mission / Instructions</label>
      <textarea id="missionText" placeholder="What to do..." readonly></textarea>

      <div class="action-row">
        <button id="editBtn" class="big-btn">Edit</button>
        <button id="saveBtn" class="big-btn" style="background:#5cc0ff;color:#012">Save Changes</button>
        <button id="previewBtn" class="big-icon-btn">üìù Read Aloud</button>
      </div>
    </div>

    <div style="margin-top:10px;" class="muted">
      Tip: Use Start Mission to get a short single-line prompt you can read to begin.
    </div>
  </section>

  <div class="footer">Made for adventures ‚Äî save the file to your iPad Files app and open in Safari. Photos stay on the device.</div>
</div>

<script>
(() => {
  // Scenario data
  const scenarios = [
    {id:1, title:"Dawn of the Burrowers", items:"Nightstick, Whisper Map", locations:"Front Deck, Cul-de-sac", mission:"Patrol the cul-de-sac three times before sunup. Mark each burrow with a loud whistle. Return to the treehouse after each patrol." , images:["front_deck","culdesac"]},
    {id:2, title:"Mirror at the Lake", items:"Sky Mirror, Beacon Flash", locations:"Pool, Pool Deck", mission:"Walk the dock and describe three objects the Mirror shows. Use your voice to reflect the creatures back into the lake.", images:["pool","trampoline"]},
    {id:3, title:"The Floating Market", items:"Stories as currency", locations:"Gazebo, Front Deck", mission:"Roleplay a trader in the gazebo who trades glowing badges for stories. Tell three short tales to win a badge.", images:["gazebo","front_deck"]},
    {id:4, title:"The Nocturne Leap", items:"Sky Boots, Cloud Marker", locations:"Trampoline, Treehouse", mission:"Complete 10 controlled jumps on the trampoline, then climb to the treehouse and describe the Sky Bridge." , images:["trampoline","treehouse"]},
    {id:5, title:"Shadow Scout", items:"Echo Call, Quiet Boots", locations:"Cul-de-sac, Front Deck", mission:"Sneak from treehouse to front deck without making noise. If you are heard, freeze for 10 seconds and try again.", images:["treehouse","culdesac","front_deck"]},
    {id:6, title:"The Gazebo Council", items:"Council Tokens, Voice Charm", locations:"Gazebo, Treehouse", mission:"Hold a council in the gazebo, appoint three allies and give each a role to defend the treehouse tonight.", images:["gazebo","treehouse"]},
    {id:7, title:"Tide of the Trampoline", items:"Sky Vision, Jump Count", locations:"Trampoline, Pool Deck", mission:"Slow controlled hops on the trampoline to 'scan' the lake. Call out five enemy positions.", images:["trampoline","pool"]},
    {id:8, title:"The Fence-Line Mystery", items:"Clue Finder, Track Reader", locations:"Backyard fence, Cul-de-sac", mission:"Walk the fence line and name five different sounds or sights. For each unique find, point and declare a trap location.", images:["culdesac","front_deck"]},
    {id:9, title:"Echoes Under the Deck", items:"Listening Shell, Flash Word", locations:"Front Deck, Under Back Deck", mission:"Sit quietly for 60 seconds and listen. Report any forest messages and use one message to make a plan.", images:["front_deck","treehouse"]},
    {id:10, title:"The Night of Many Lights", items:"Star Catcher, Glow Talk", locations:"Treehouse, Gazebo, Front Deck", mission:"Place imaginary lights by naming landmarks (count to 10). Each saved light gives one safe hour.", images:["treehouse","gazebo","front_deck"]},
    {id:11, title:"The Pool‚Äôs Secret Gate", items:"Gate Riddle, Calm Breath", locations:"Pool, Gazebo", mission:"Create a riddle at the gazebo. If the riddle is solved, a calm path across the Pool of Shadows opens.", images:["gazebo","pool"]},
    {id:12, title:"Last Watch of the Cul-de-sac", items:"Banner of Dawn, Victory Call", locations:"Front Deck, Cul-de-sac, Treehouse", mission:"Make a victory signal (clap/song) from the front deck. If it's loud and proud, the forest retreats until morning.", images:["front_deck","culdesac","treehouse"]}
  ];

  // DOM refs
  const daySelect = document.getElementById('daySelect');
  const selectedDayDisplay = document.getElementById('selectedDayDisplay');
  const scenarioTitle = document.getElementById('scenarioTitle');
  const itemsText = document.getElementById('itemsText');
  const locationText = document.getElementById('locationText');
  const missionText = document.getElementById('missionText');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const startBtn = document.getElementById('startBtn');
  const randomBtn = document.getElementById('randomBtn');
  const editBtn = document.getElementById('editBtn');
  const saveBtn = document.getElementById('saveBtn');
  const previewBtn = document.getElementById('previewBtn');
  const resetImages = document.getElementById('resetImages');

  // image slots mapping
  const imageSlots = {
    front_deck: document.getElementById('slot-front'),
    treehouse: document.getElementById('slot-tree'),
    culdesac: document.getElementById('slot-cul'),
    trampoline: document.getElementById('slot-tramp'),
    gazebo: document.getElementById('slot-gaz'),
    pool: document.getElementById('slot-pool')
  };
  const fileInputs = {
    front_deck: document.getElementById('file-front'),
    treehouse: document.getElementById('file-tree'),
    culdesac: document.getElementById('file-cul'),
    trampoline: document.getElementById('file-tramp'),
    gazebo: document.getElementById('file-gaz'),
    pool: document.getElementById('file-pool')
  };

  // populate day selector
  scenarios.forEach(s => {
    const opt = document.createElement('option');
    opt.value = s.id;
    opt.textContent = 'Day ' + s.id + ' ‚Äî ' + s.title;
    daySelect.appendChild(opt);
  });

  // localStorage keys
  const LS_IMAGES = '99n_images_v1';
  const LS_SCENARIO_EDIT = '99n_scenedata_v1';

  // load saved images
  let savedImages = JSON.parse(localStorage.getItem(LS_IMAGES) || '{}');
  let editedScenarioData = JSON.parse(localStorage.getItem(LS_SCENARIO_EDIT) || '{}');

  function renderImageSlot(key){
    const el = imageSlots[key];
    el.innerHTML = `<div class="img-label">${el.querySelector('.img-label')?.textContent || key}</div>`;
    const existing = savedImages[key];
    if(existing){
      const img = document.createElement('img');
      img.src = existing;
      el.appendChild(img);
      const clearBtn = document.createElement('button');
      clearBtn.textContent = 'Remove';
      clearBtn.style.position='absolute';
      clearBtn.style.right='8px'; clearBtn.style.bottom='8px';
      clearBtn.style.background='rgba(0,0,0,0.45)'; clearBtn.style.color='#fff'; clearBtn.style.border='none';
      clearBtn.style.padding='6px 8px'; clearBtn.style.borderRadius='8px'; clearBtn.style.fontSize='12px';
      clearBtn.onclick = (ev) => { ev.stopPropagation(); delete savedImages[key]; persistImages(); renderAllImages(); };
      el.appendChild(clearBtn);
    } else {
      const placeholder = document.createElement('div');
      placeholder.className='placeholder-text';
      placeholder.textContent='Tap to add photo';
      el.appendChild(placeholder);
    }
    // attach file input
    const input = fileInputs[key];
    input.value = '';
    el.appendChild(input);
  }

  function renderAllImages(){
    Object.keys(imageSlots).forEach(k => renderImageSlot(k));
  }

  function persistImages(){
    localStorage.setItem(LS_IMAGES, JSON.stringify(savedImages));
  }

  // wire file inputs
  Object.keys(fileInputs).forEach(k=>{
    const fi = fileInputs[k];
    fi.addEventListener('change', (e) => {
      const f = e.target.files[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = function(ev){
        savedImages[k] = ev.target.result;
        persistImages();
        renderAllImages();
      };
      reader.readAsDataURL(f);
    });
    // click on slot triggers file input
    imageSlots[k].addEventListener('click', ()=> fi.click());
  });

  // reset images
  resetImages.addEventListener('click', ()=>{
    if(confirm('Clear saved photos? This only clears photos stored in this browser on this device.')) {
      savedImages = {};
      persistImages();
      renderAllImages();
    }
  });

  // scenario selection
  function getScenarioById(id){ return scenarios.find(s => s.id === Number(id)); }

  function populateScenario(id){
    const s = getScenarioById(id);
    if(!s) return;
    selectedDayDisplay.textContent = 'Day ' + s.id;
    scenarioTitle.textContent = s.title;
    // if user saved edits for this day, load them
    const edited = editedScenarioData['day_'+s.id];
    itemsText.value = edited?.items || s.items;
    locationText.value = edited?.locations || s.locations;
    missionText.value = edited?.mission || s.mission;
    // highlight relevant images
    // show border on relevant image slots
    Object.keys(imageSlots).forEach(k=>{
      const el = imageSlots[k];
      if(s.images && s.images.includes(k)){
        el.style.border = '2px solid rgba(110,231,183,0.25)';
        el.style.boxShadow = '0 6px 18px rgba(110,231,183,0.06)';
      } else {
        el.style.border = '2px dashed rgba(255,255,255,0.03)';
        el.style.boxShadow = 'none';
      }
    });
    // lock textareas by default
    itemsText.readOnly = locationText.readOnly = missionText.readOnly = true;
    editBtn.textContent = 'Edit';
  }

  // navigation
  prevBtn.addEventListener('click', ()=>{
    let v = Number(daySelect.value);
    v = v>1 ? v-1 : scenarios.length;
    daySelect.value = v;
    populateScenario(v);
  });
  nextBtn.addEventListener('click', ()=>{
    let v = Number(daySelect.value);
    v = v<scenarios.length ? v+1 : 1;
    daySelect.value = v;
    populateScenario(v);
  });
  daySelect.addEventListener('change', ()=> populateScenario(daySelect.value));

  // start mission (read one-line prompt)
  startBtn.addEventListener('click', ()=>{
    const s = getScenarioById(daySelect.value);
    if(!s) return;
    const prompt = `${s.title} ‚Äî ${s.mission}`;
    // simple on-screen alert-style prompt
    alert(prompt);
  });

  randomBtn.addEventListener('click', ()=>{
    const idx = Math.floor(Math.random()*scenarios.length);
    daySelect.value = scenarios[idx].id;
    populateScenario(scenarios[idx].id);
  });

  // edit & save
  editBtn.addEventListener('click', ()=>{
    const editable = itemsText.readOnly;
    itemsText.readOnly = locationText.readOnly = missionText.readOnly = !editable;
    editBtn.textContent = editable ? 'Cancel Edit' : 'Edit';
    if(editable){
      // into edit mode: focus mission
      missionText.focus();
    } else {
      // cancelled: restore from stored scenario
      populateScenario(daySelect.value);
    }
  });

  saveBtn.addEventListener('click', ()=>{
    const id = daySelect.value;
    editedScenarioData['day_'+id] = {
      items: itemsText.value,
      locations: locationText.value,
      mission: missionText.value
    };
    localStorage.setItem(LS_SCENARIO_EDIT, JSON.stringify(editedScenarioData));
    itemsText.readOnly = locationText.readOnly = missionText.readOnly = true;
    editBtn.textContent = 'Edit';
    alert('Saved for Day ' + id);
  });

  // preview / read aloud (simple speech if available)
  previewBtn.addEventListener('click', ()=>{
    const s = getScenarioById(daySelect.value);
    if(!s) return;
    const text = `Mission for ${s.title}. Items: ${itemsText.value}. Locations: ${locationText.value}. Instructions: ${missionText.value}`;
    if('speechSynthesis' in window){
      const utter = new SpeechSynthesisUtterance(text);
      utter.rate = 0.95; utter.pitch = 1;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    } else {
      alert(text);
    }
  });

  // persist edited scenarios load
  function loadEdited(){
    try {
      editedScenarioData = JSON.parse(localStorage.getItem(LS_SCENARIO_EDIT) || '{}');
    } catch(e) { editedScenarioData = {}; }
  }

  // initialize
  loadEdited();
  renderAllImages();
  daySelect.value = 1;
  populateScenario(1);

  // accessible keyboard nav for iPad keyboards
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'ArrowLeft') prevBtn.click();
    if(e.key === 'ArrowRight') nextBtn.click();
  });

})();
</script>
</body>
</html>
