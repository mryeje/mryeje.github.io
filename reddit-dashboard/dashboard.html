<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reddit Demand Mapper Dashboard</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; }
    h1 { color: #333; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    th { background-color: #007bff; color: white; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    tr:hover { background-color: #e0f0ff; }
    .hashtags { color: #555; font-style: italic; }
</style>
</head>
<body>
<h1>Reddit Demand Mapper - TikTok Opportunities</h1>
<table id="opportunitiesTable">
    <thead>
        <tr>
            <th>Theme</th>
            <th>Content Angle</th>
            <th>Avg Engagement</th>
            <th>Total Comments</th>
            <th>Suggested Hashtags</th>
            <th>Sample Posts</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
const jsonFile = "latest.json"; // Update this if using a timestamped file

fetch(jsonFile)
    .then(response => {
        if (!response.ok) throw new Error(`Failed to load ${jsonFile}`);
        return response.json();
    })
    .then(data => {
        const tbody = document.querySelector("#opportunitiesTable tbody");
        data.forEach(opp => {
            const row = document.createElement("tr");

            const samplePostsHtml = opp.sample_posts.map(p =>
                `<a href="${p.permalink}" target="_blank">${p.title}</a> (${p.score} pts, ${p.num_comments} comments)`
            ).join("<br>");

            row.innerHTML = `
                <td>${opp.theme.replace(/_/g, ' ').toUpperCase()}</td>
                <td>${opp.content_angle}</td>
                <td>${opp.avg_engagement.toFixed(2)}</td>
                <td>${opp.total_comments}</td>
                <td class="hashtags">${opp.hashtags.join(', ')}</td>
                <td>${samplePostsHtml}</td>
            `;
            tbody.appendChild(row);
        });
    })
    .catch(error => {
        document.body.insertAdjacentHTML("beforeend", `<p style="color:red;">${error}</p>`);
    });
</script>
</body>
</html>
