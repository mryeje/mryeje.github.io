{
  "openapi": "3.0.1",
  "info": { "title": "Video Processing Plugin", "version": "1.0.1" },
  "servers": [{ "url": "https://6be028c12f53.ngrok-free.app" }],
  "paths": {
    "/process": {
      "post": {
        "operationId": "process_process_post",
        "summary": "Submit a Recipe for processing",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "src": { "type": "string", "description": "https://0c28744a4c9a.ngrok-free.app " },
                  "style_profile": { "type": "string" },
                  "generate_thumbnails": { "type": "boolean" },
                  "add_text_overlay": { "type": "boolean" },
                  "multi_platform": { "type": "boolean" },
                  "platforms": { "type": "array", "items": { "type": "string" } },

                  "clips": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "id": { "type": "string" },
                        "label": { "type": "string" },

                        "start": { "type": "number", "description": "clip start in seconds (numeric) - REQUIRED for processing" },
                        "end": { "type": "number", "description": "clip end in seconds (numeric)" },
                        "clip_duration": { "type": "number", "description": "optional duration in seconds (end = start + duration if provided)" },

                        /* Canonical overlay instruction object the runner expects */
                        "overlay_instructions": {
                          "type": "object",
                          "properties": {
                            "placement": { "type": "string" },
                            "font": { "type": "string" },
                            "size": { "type": "string" },
                            "style": { "type": "string" },
                            "effects": {
                              "type": "array",
                              "items": { "type": "string" },
                              "description": "Preferred: effects array. Builder may also emit single 'effect' key."
                            },
                            "effect": { "type": "string" },
                            "color": { "type": "string", "description": "Hex color recommended (#rrggbb)" },
                            "background": { "type": "string" },
                            "timing": { "type": "string", "enum": ["clip_relative", "source_absolute"], "description": "How overlay start/end should be interpreted" },
                            "overlay_text": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "text": { "type": "string" },
                                  "start": { "type": "number", "description": "seconds; clip-relative if timing=clip_relative or clip.start present" },
                                  "end": { "type": "number" },
                                  "placement": { "type": "string" },
                                  "font": { "type": "string" },
                                  "size": { "type": "string" },
                                  "style": { "type": "string" },
                                  "effects": { "type": "array", "items": { "type": "string" } },
                                  "effect": { "type": "string" },
                                  "color": { "type": "string" },
                                  "background": { "type": "string" }
                                }
                              }
                            }
                          }
                        },

                        /* Backward-compatible flattened overlay array (some builders produce this) */
                        "overlay_text": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "text": { "type": "string" },
                              "start": { "type": "number" },
                              "end": { "type": "number" },
                              "placement": { "type": "string" }
                            }
                          }
                        },

                        /* Canonical numeric subtitle format (preferred by runner) */
                        "srt_for_clip": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "start": { "type": "number" },
                              "end": { "type": "number" },
                              "text": { "type": "string" }
                            }
                          },
                          "description": "Preferred: numeric clip-relative subtitles (0.0 = clip start)"
                        },

                        /* Backward-compatible 'subtitles' string-time format */
                        "subtitles": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "from": { "type": "string", "description": "HH:MM:SS,mmm" },
                              "to": { "type": "string", "description": "HH:MM:SS,mmm" },
                              "text": { "type": "string" }
                            }
                          }
                        }
                      }
                    }
                  },

                  "thumbnail_strategy": { "type": "string", "enum": ["start", "middle", "end"] },
                  "export_srt": { "type": "boolean" }
                },
                "required": ["src", "clips"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Processing job accepted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { "type": "string" },
                    "job_id": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
