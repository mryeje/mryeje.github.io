<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<title>99 Nights ‚Äî Little Camp</title>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<style>
  :root{
    --bg:#071621; --card:#0b1722; --accent:#6ee7b7; --muted:#9aa8bb; --glass: rgba(255,255,255,0.03);
    --good:#8ef08e; --bad:#ffb2b2; --gold:#ffd36b;
  }
  html,body{height:100%;margin:0;font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial;background:linear-gradient(180deg,#04101a 0,#071621 100%);color:#eaf7f2;}
  .app{max-width:920px;margin:12px auto;padding:14px;display:grid;grid-template-columns:1fr 360px;gap:14px;box-sizing:border-box;}
  header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{font-size:20px;margin:0;color:var(--accent)}
  .subtitle{color:var(--muted);font-size:13px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:12px;box-shadow:0 8px 20px rgba(2,6,23,0.6)}
  .main{display:flex;flex-direction:column;gap:10px}
  .selector{display:flex;gap:8px;align-items:center}
  select{flex:1;padding:10px;border-radius:10px;border:none;font-size:16px;background:transparent;color:inherit}
  .big-btn{background:var(--accent);color:#042023;border:none;padding:12px;border-radius:12px;font-weight:800;font-size:16px;touch-action:manipulation}
  .big-icon-btn{background:transparent;border:2px solid var(--muted);color:var(--muted);padding:10px;border-radius:10px}
  .image-area{height:220px;border-radius:10px;background:var(--glass);display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}
  .title{font-size:18px;font-weight:800;color:var(--accent);margin:6px 0}
  label{font-size:13px;color:var(--muted);margin-bottom:6px}
  textarea{width:100%;min-height:56px;border-radius:10px;padding:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;resize:vertical;font-size:14px}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .side{display:flex;flex-direction:column;gap:10px}
  .panel{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));min-height:64px}
  .inventory-list, .log-list{list-style:none;padding:0;margin:0;max-height:260px;overflow:auto}
  .inventory-item{display:flex;align-items:center;gap:8px;padding:6px;border-radius:8px;margin-bottom:6px;background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.002))}
  #scanner{width:100%;height:300px;border-radius:10px;overflow:hidden;background:#000;display:none;margin-top:12px}
  .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:9999;background:rgba(0,0,0,0.7)}
  .overlay.show{display:flex}
  .encounter{width:90%;max-width:720px;background:#0a131a;border-radius:12px;padding:16px;color:#fff;box-shadow:0 10px 30px rgba(0,0,0,0.6);display:flex;gap:12px;align-items:center}
  .enemy-icon{font-size:48px}
  .encounter-info{flex:1}
  .countdown{font-size:28px;font-weight:900;color:var(--gold)}
  .light-btn{background:#fff;color:#042023;padding:10px;border-radius:10px;border:none;font-weight:800}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:rgba(3,7,8,0.9);color:#fff;padding:10px 14px;border-radius:10px;display:none}
  .health-bar{height:10px;background:rgba(255,255,255,0.06);border-radius:10px;overflow:hidden;margin-top:6px}
  .health-fill{height:100%;background:linear-gradient(90deg,#66ff88,#2fb74a);width:100%}
  @media (max-width:920px){.app{grid-template-columns:1fr}.image-area{height:180px}}
</style>
</head>
<body>
<div class="app">
  <header>
    <div>
      <h1>üå≤ 99 Nights ‚Äî Little Camp</h1>
      <div class="subtitle">Scan QR tags to change the story! Featuring your yard‚Äôs magical landmarks.</div>
    </div>
    <div style="text-align:right">
      <div class="card" style="padding:8px;border-radius:10px;text-align:center">
        <div id="healthLabel" style="font-weight:800">100%</div>
        <div class="health-bar"><div id="healthFill" class="health-fill"></div></div>
      </div>
    </div>
  </header>

  <div class="main">
    <div class="card">
      <div class="selector">
        <button class="big-icon-btn" id="prevBtn">‚óÄ</button>
        <select id="daySelect"></select>
        <button class="big-icon-btn" id="nextBtn">‚ñ∂</button>
      </div>

      <div class="image-area" id="imageArea"></div>
      <div class="title" id="scenarioTitle">Welcome</div>

      <label>üß∞ Scenario Items</label>
      <textarea id="itemsText" readonly></textarea>
      <label style="margin-top:8px">üìç Locations</label>
      <textarea id="locationText" readonly></textarea>
      <label style="margin-top:8px">üéØ Mission</label>
      <textarea id="missionText" readonly></textarea>

      <div class="actions" style="margin-top:10px">
        <button class="big-btn" id="startBtn">Start Mission ‚ñ∂</button>
        <button class="big-btn" id="speakBtn">Read Aloud üìù</button>
        <button class="big-btn" id="scanBtn">Scan QR üì∑</button>
      </div>

      <div id="scanner"><div id="qr-reader" style="width:100%"></div></div>
    </div>

    <div class="card">
      <div style="font-weight:800">üìñ Event Log</div>
      <ul id="eventLog" class="log-list"></ul>
    </div>
  </div>

  <aside class="side">
    <div class="panel card">
      <div style="font-weight:800">üéí Inventory</div>
      <ul id="inventoryList" class="inventory-list"></ul>
    </div>
  </aside>
</div>

<!-- Encounter Overlay -->
<div id="overlay" class="overlay">
  <div class="encounter">
    <div class="enemy-icon" id="enemyEmoji">üåë</div>
    <div class="encounter-info">
      <div id="encounterTitle">A shadow appears!</div>
      <div id="encounterLine">Survive for <span class="countdown" id="countdown">10</span> sec or use a Lantern!</div>
    </div>
    <div>
      <button id="useLightBtn" class="light-btn">Light Up üî¶</button>
    </div>
  </div>
</div>
<div id="toast" class="toast"></div>

<script>
(() => {
  /* Scenarios using your real image filenames (root folder) */
  const scenarios = [
    {
      id:1,title:"First Watch",
      items:"Campfire Torch, Whisper Map",
      locations:"Sentinel Porch, Shadow Edge",
      mission:"Patrol the Shadow Edge (cul-de-sac) and call out 3 animal sounds. Return to Sentinel Porch (front deck).",
      image:"culdesac.jpg"
    },
    {
      id:2,title:"Leap of Clouds",
      items:"Sky Boots, Cloud Marker",
      locations:"Cloudspring, Sky Tower",
      mission:"Do 10 jumps on the Cloudspring (trampoline). Then climb Sky Tower (treehouse) and describe what you see.",
      image:"trampoline.jpg"
    },
    {
      id:3,title:"Council Gathering",
      items:"Council Tokens, Voice Charm",
      locations:"Council Ring, Sky Tower",
      mission:"Hold a council at the Council Ring (gazebo). Pick 2 allies and assign them roles to defend Sky Tower.",
      image:"gazebo.jpg"
    },
    {
      id:4,title:"Moonlit Waters",
      items:"Star Mirror, Beacon Flash",
      locations:"Moonlit Lake, Dock",
      mission:"Walk the dock. Use the Star Mirror to name 3 things reflected in the Moonlit Lake (pool).",
      image:"pool.jpg"
    },
    {
      id:5,title:"Return to the Tower",
      items:"Banner of Dawn, Victory Call",
      locations:"Sky Tower, Sentinel Porch",
      mission:"Make a loud victory signal from the Sentinel Porch (front deck). If it's strong, the forest retreats for the night.",
      image:"front_deck.JPG"
    },
    {
      id:6,title:"Sky Tower Watch",
      items:"Night Lantern, Quiet Boots",
      locations:"Sky Tower",
      mission:"Climb Sky Tower (treehouse) and describe three stars you can see. Give each star a secret name.",
      image:"treehouse.jpg"
    }
  ];

  let inventory = JSON.parse(localStorage.getItem("inv")||"[]");
  let eventsLog = JSON.parse(localStorage.getItem("log")||"[]");
  let health = Number(localStorage.getItem("hp")||"100");

  const enemies = [
    {name:"Shadow Deer",emoji:"ü¶å"},
    {name:"Giant Owl",emoji:"ü¶â"},
    {name:"Forest Tricksters",emoji:"üé≠"}
  ];
  const forageTable = [
    {text:"ü•ï Roots ‚Äî +2 health",hp:+2},
    {text:"üêá Rabbit ‚Äî +5 health",hp:+5},
    {text:"üçì Berries ‚Äî +3 health",hp:+3},
    {text:"üçÑ Mushrooms ‚Äî -5 health",hp:-5}
  ];

  const daySelect=document.getElementById("daySelect"),
        scenarioTitle=document.getElementById("scenarioTitle"),
        itemsText=document.getElementById("itemsText"),
        locationText=document.getElementById("locationText"),
        missionText=document.getElementById("missionText"),
        imageArea=document.getElementById("imageArea"),
        inventoryList=document.getElementById("inventoryList"),
        eventLog=document.getElementById("eventLog"),
        healthLabel=document.getElementById("healthLabel"),
        healthFill=document.getElementById("healthFill"),
        toast=document.getElementById("toast");

  scenarios.forEach(s=>{
    const o=document.createElement("option");
    o.value=s.id;o.textContent=`Day ${s.id} ‚Äî ${s.title}`;
    daySelect.appendChild(o);
  });

  function showScenario(id){
    const s=scenarios.find(x=>x.id==id);
    if(!s) return;
    scenarioTitle.textContent=s.title;
    itemsText.value=s.items;
    locationText.value=s.locations;
    missionText.value=s.mission;
    imageArea.innerHTML=`<img src="${s.image}" alt="${s.title}" style="width:100%;height:100%;object-fit:cover;border-radius:10px">`;
    daySelect.value=id;
    localStorage.setItem("day",id);
  }

  function addEvent(t){eventsLog.push(t);if(eventsLog.length>50)eventsLog.shift();renderLog();localStorage.setItem("log",JSON.stringify(eventsLog));}
  function renderLog(){eventLog.innerHTML="";eventsLog.slice().reverse().forEach(e=>{const li=document.createElement("li");li.textContent=e;eventLog.appendChild(li);});}
  function renderInventory(){inventoryList.innerHTML="";inventory.forEach(it=>{const li=document.createElement("li");li.className="inventory-item";li.textContent=it;inventoryList.appendChild(li);});localStorage.setItem("inv",JSON.stringify(inventory));}
  function renderHealth(){healthLabel.textContent=health+"%";healthFill.style.width=health+"%";localStorage.setItem("hp",health);}
  function showToast(t){toast.textContent=t;toast.style.display="block";setTimeout(()=>toast.style.display="none",2000);}

  function handleQR(code){
    code=code.trim().toLowerCase();
    if(code.startsWith("item:")){
      const item=code.split(":")[1];
      if(!inventory.includes(item)){inventory.push(item);renderInventory();addEvent("‚ú® Found "+item);showToast("Found "+item);}
      return;
    }
    if(code==="event:enemy_chase"){startEncounter();return;}
    if(code==="forage"){const f=forageTable[Math.random()*forageTable.length|0];health=Math.max(0,Math.min(100,health+f.hp));renderHealth();addEvent("üå≤ Foraged: "+f.text);showToast(f.text);return;}
    if(code.startsWith("set:day=")){const n=parseInt(code.split("=")[1]);if(!isNaN(n))showScenario(n);}
  }

  let qrScanner=null;
  document.getElementById("scanBtn").addEventListener("click",async()=>{
    const vw=window.innerWidth,vh=window.innerHeight,boxSize=Math.min(vw,vh)*0.6;
    document.getElementById("scanner").style.display="block";
    if(qrScanner) return;
    qrScanner=new Html5Qrcode("qr-reader");
    try{
      await qrScanner.start({facingMode:"environment"},{fps:10,qrbox:{width:boxSize,height:boxSize}},msg=>{
        qrScanner.pause();handleQR(msg);setTimeout(()=>qrScanner.resume(),1000);
      });
    }catch(e){showToast("Camera error");console.error(e);}
  });

  // Encounter
  const overlay=document.getElementById("overlay"),enemyEmoji=document.getElementById("enemyEmoji"),encounterTitle=document.getElementById("encounterTitle"),countdownEl=document.getElementById("countdown"),useLightBtn=document.getElementById("useLightBtn");
  let timer=null,time=0;
  function startEncounter(){const e=enemies[Math.random()*enemies.length|0];enemyEmoji.textContent=e.emoji;encounterTitle.textContent=`${e.name} is near!`;time=10;overlay.classList.add("show");timer=setInterval(()=>{time--;countdownEl.textContent=time;if(time<=0){clearInterval(timer);endEncounter(false,e)}},1000);}
  function endEncounter(survived,e){overlay.classList.remove("show");clearInterval(timer);if(survived){addEvent("‚úÖ Escaped "+e.name);showToast("Escaped!")}else{addEvent("üí• Caught by "+e.name);showToast("Ouch! -10 health");health=Math.max(0,health-10);renderHealth();}}
  useLightBtn.addEventListener("click",()=>{endEncounter(true,{name:"the shadow"});});

  // init
  const d=localStorage.getItem("day")||1;showScenario(d);renderInventory();renderLog();renderHealth();
})();
</script>
</body>
</html>
