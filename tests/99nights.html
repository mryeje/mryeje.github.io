<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>99 Nights in the Susan Court Forest</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #071621; --card: #0b1722; --accent: #6ee7b7; --muted: #9aa8bb;
      --glass: rgba(255,255,255,0.03); --good: #8ef08e; --bad: #ffb2b2; --gold: #ffd36b;
    }
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: linear-gradient(180deg, #04101a 0, var(--bg) 100%);
      color: #eaf7f2; min-height: 100vh; padding: 14px;
    }
    .app { max-width: 920px; margin: 12px auto; display: grid; grid-template-columns: 1fr 360px; gap: 14px; }
    header { grid-column: 1/-1; display: flex; justify-content: space-between; gap: 12px; margin-bottom: 10px; }
    h1 { font-size: 24px; color: var(--accent); }
    .subtitle { color: var(--muted); font-size: 13px; }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: 12px; padding: 16px; box-shadow: 0 8px 20px rgba(2,6,23,0.6);
    }
    .main { display: flex; flex-direction: column; gap: 14px; }
    .scenario-container { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .scenario-details { display: flex; flex-direction: column; }
    .scenario-enemy-status > div { display: flex; gap: 10px; }
    .enemy-status { flex: 1; min-width: 140px; max-width: 160px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius: 12px; padding: 12px; }
    .enemy-status h3 { color: var(--accent); font-size: 15px; margin-bottom: 6px; }
    .enemy-status-content { display: flex; flex-direction: column; align-items: center; gap: 8px; }
    .enemy-status-image { width: 70px; height: 70px; border-radius: 10px; object-fit: cover; border: 2px solid #ff5e5e; }
    .enemy-status-name { font-weight: bold; color: #ff5e5e; font-size: 14px; text-align: center; }
    .inventory-list, .log-list { list-style: none; padding: 0; margin: 0; max-height: 260px; overflow: auto; }
    .inventory-item { padding: 6px; margin-bottom: 6px; border-radius: 8px; cursor: pointer; }
    .inventory-item.disabled { opacity: 0.4; pointer-events: none; }
    .no-enemy { text-align: center; color: var(--muted); font-style: italic; padding: 10px; }
    .enemy-display { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8); background: rgba(0,0,0,0.85); border-radius: 16px; padding: 20px; text-align: center; border: 2px solid #ff3c3c; box-shadow: 0 0 30px rgba(255,0,0,0.4); opacity: 0; transition: 0.5s; width: 320px; pointer-events: none; z-index: 999; }
    .enemy-display.active { opacity: 1; transform: translate(-50%, -50%) scale(1); pointer-events: auto; }
    .enemy-image { width: 200px; height: 200px; border-radius: 12px; border: 3px solid #ff5e5e; margin-bottom: 15px; }
    .enemy-name { font-size: 24px; font-weight: bold; color: #ff5e5e; margin-bottom: 10px; }
    .enemy-description { color: #fff; font-size: 16px; margin-bottom: 15px; }
    .close-enemy { background: #ff3c3c; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }
    .health-bar { height: 10px; background: rgba(255,255,255,0.06); border-radius: 10px; overflow: hidden; margin-top: 6px; }
    .health-fill { height: 100%; background: linear-gradient(90deg,#66ff88,#2fb74a); width: 100%; }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div>
      <h1>üå≤ 99 Nights ‚Äî Susan Court Forest</h1>
      <div class="subtitle">Scan QR tags to change the story!</div>
    </div>
    <div style="text-align:right">
      <div class="card" style="padding:8px;border-radius:10px;text-align:center">
        <div id="healthLabel" style="font-weight:800">100%</div>
        <div class="health-bar"><div id="healthFill" class="health-fill"></div></div>
      </div>
    </div>
  </header>

  <div class="main">
    <div class="card">
      <div class="scenario-container">
        <div class="scenario-details">
          <label>üß∞ Scenario Items</label>
          <textarea id="itemsText" readonly></textarea>
          <label>üìç Locations</label>
          <textarea id="locationText" readonly></textarea>
        </div>
        <div class="scenario-enemy-status">
          <div>
            <!-- Enemy Status -->
            <div class="enemy-status">
              <h3>üõ°Ô∏è Enemy</h3>
              <div id="enemyStatusContent"><div class="no-enemy">No enemies yet</div></div>
            </div>
            <!-- Weapons -->
            <div class="enemy-status">
              <h3>üî¶ Weapons</h3>
              <ul id="weaponsList" class="inventory-list"></ul>
            </div>
          </div>
        </div>
      </div>
      <label>üéØ Mission</label>
      <textarea id="missionText" readonly></textarea>
      <div class="actions">
        <button class="big-btn" id="startBtn">Start ‚ñ∂</button>
        <button class="big-btn" id="scanBtn">Scan üì∑</button>
      </div>
    </div>
    <div class="card"><div style="font-weight:800">üìñ Log</div><ul id="eventLog" class="log-list"></ul></div>
  </div>
  <aside class="side">
    <div class="card"><div style="font-weight:800">üéí Inventory</div><ul id="inventoryList" class="inventory-list"></ul></div>
  </aside>
</div>

<!-- Enemy Encounter -->
<div class="enemy-display" id="enemyDisplay">
  <div class="enemy-name" id="enemyName"></div>
  <img class="enemy-image" id="enemyImage">
  <div class="enemy-description" id="enemyDescription"></div>
  <button class="close-enemy" id="closeEnemy">Continue</button>
</div>

<script>
(() => {
  const enemies = [
    {name:"The Deer",emoji:"ü¶å",image:"enemies/deer.png",description:"Fears bright light."},
    {name:"The Owl",emoji:"ü¶â",image:"enemies/owl.png",description:"Unkillable; only stunned by light."},
    {name:"Forest Cultists",emoji:"üë§",image:"enemies/cultists.png",description:"Raid camp every few nights."},
    {name:"Wolf",emoji:"üê∫",image:"enemies/wolf.png",description:"Hunts in packs."},
    {name:"Bear",emoji:"üêª",image:"enemies/bear.png",description:"Strong predator."}
  ];

  const forageTable=[{text:"ü•ï Roots +2",hp:2},{text:"üçì Berries +3",hp:3},{text:"üçÑ Mushrooms -5",hp:-5}];

  let inventory=JSON.parse(localStorage.getItem("inv")||"[]");
  let weapons=JSON.parse(localStorage.getItem("weapons")||'["Flashlight"]');
  let eventsLog=JSON.parse(localStorage.getItem("log")||"[]");
  let health=Number(localStorage.getItem("hp")||"100");
  let lastEnemy=null, flashlightActive=false, escapeTimer=null;

  const enemyStatusContent=document.getElementById("enemyStatusContent"),
        weaponsList=document.getElementById("weaponsList"),
        inventoryList=document.getElementById("inventoryList"),
        eventLog=document.getElementById("eventLog"),
        healthLabel=document.getElementById("healthLabel"),
        healthFill=document.getElementById("healthFill"),
        scanBtn=document.getElementById("scanBtn"),
        enemyDisplay=document.getElementById("enemyDisplay"),
        enemyName=document.getElementById("enemyName"),
        enemyImage=document.getElementById("enemyImage"),
        enemyDescription=document.getElementById("enemyDescription"),
        closeEnemy=document.getElementById("closeEnemy");

  function updateEnemyStatus(enemy){
    lastEnemy=enemy;
    if(enemy){
      enemyStatusContent.innerHTML=`<div class="enemy-status-content"><img src="${enemy.image}" class="enemy-status-image"><div class="enemy-status-name">${enemy.name} ${enemy.emoji}</div></div>`;
      localStorage.setItem("lastEnemy",JSON.stringify(enemy));
    } else {
      enemyStatusContent.innerHTML='<div class="no-enemy">No enemies yet</div>';
    }
  }

  function renderWeapons(){
    weaponsList.innerHTML="";
    weapons.forEach(w=>{
      const li=document.createElement("li");
      li.className="inventory-item";
      li.textContent=w;
      if(w==="Flashlight"){
        li.onclick=()=>{
          if(li.classList.contains("disabled")) return;
          flashlightActive=true;
          li.classList.add("disabled");
          addEvent("üî¶ Flashlight on! Rescan in 5s.");
          if(escapeTimer) clearTimeout(escapeTimer);
          escapeTimer=setTimeout(()=>{flashlightActive=false;li.classList.remove("disabled");addEvent("‚ùå Flashlight faded.");},5000);
        };
      }
      weaponsList.appendChild(li);
    });
    localStorage.setItem("weapons",JSON.stringify(weapons));
  }

  function addEvent(t){eventsLog.push(t);if(eventsLog.length>10)eventsLog.shift();renderLog();localStorage.setItem("log",JSON.stringify(eventsLog));}
  function renderLog(){eventLog.innerHTML="";eventsLog.forEach(e=>{const li=document.createElement("li");li.textContent=e;eventLog.appendChild(li);});}
  function renderInventory(){inventoryList.innerHTML="";inventory.forEach(it=>{const li=document.createElement("li");li.textContent=it;li.className="inventory-item";inventoryList.appendChild(li);});localStorage.setItem("inv",JSON.stringify(inventory));}
  function renderHealth(){healthLabel.textContent=health+"%";healthFill.style.width=health+"%";localStorage.setItem("hp",health);}

  function showEnemyEncounter(enemy){enemyName.textContent=enemy.name+" "+enemy.emoji;enemyImage.src=enemy.image;enemyDescription.textContent=enemy.description;updateEnemyStatus(enemy);enemyDisplay.classList.add("active");setTimeout(hideEnemyEncounter,7000);}
  function hideEnemyEncounter(){enemyDisplay.classList.remove("active");}

  function handleQR(code){
    code=code.trim().toLowerCase();
    if(code.startsWith("item:")){const item=code.split(":")[1];if(!inventory.includes(item)){inventory.push(item);renderInventory();addEvent("‚ú® Found "+item);}return;}
    if(code==="event:enemy_chase"){const enemy=enemies[Math.floor(Math.random()*enemies.length)];showEnemyEncounter(enemy);addEvent("üåë "+enemy.emoji+" "+enemy.name+" is approaching!");if(enemy.name==="The Deer"||enemy.name==="The Owl"){if(flashlightActive){addEvent("‚úÖ Escaped "+enemy.name+"!");flashlightActive=false;clearTimeout(escapeTimer);escapeTimer=null;renderWeapons();}else{addEvent("‚ùå Could not escape "+enemy.name+"!");health=Math.max(0,health-20);renderHealth();}}return;}
    if(code==="forage"){const f=forageTable[Math.floor(Math.random()*forageTable.length)];health=Math.max(0,Math.min(100,health+f.hp));renderHealth();addEvent("üå≤ Foraged: "+f.text);return;}
  }

  scanBtn.addEventListener("click",()=>{addEvent("üì∑ Scan simulated (add real QR logic)");});

  closeEnemy.addEventListener("click", hideEnemyEncounter);

  renderInventory();renderWeapons();renderLog();renderHealth();
  const savedEnemy=localStorage.getItem("lastEnemy");if(savedEnemy)updateEnemyStatus(JSON.parse(savedEnemy));
  addEvent("Welcome to Susan Court Forest. Adventure begins...");
})();
</script>
</body>
</html>
